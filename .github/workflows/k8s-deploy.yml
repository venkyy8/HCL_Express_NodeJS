name: Run Nginx with kubectl

on:
  # push:
  #   branches:
  #     - main
  workflow_dispatch:

jobs:
  kubectl:
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout repository (required by GitHub Actions)
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Install kubectl
      - name: Install kubectl
        uses: azure/setup-kubectl@v4
        with:
          version: 'latest'

      # 3. Set up kubeconfig
      - name: Configure kubeconfig
        run: |
          mkdir -p $HOME/.kube
          echo "${{ secrets.KUBECONFIG_DATA }}" | base64 --decode > $HOME/.kube/config

      # 4. Run nginx using kubectl
      - name: Run nginx pod
        run: |
          kubectl run nginx --image=nginx
          kubectl get pods
